<!DOCTYPE html>
<html lang="id">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warung Jastip Yanoshi</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #076eb3; 
            --contact-color: #25d366;
            --accent-color: #076eb3;
            --bg-color: #f4f4f9;
            --text-color: #333;
            --white: #ffffff;
            --gray: #ecf0f1;
            --black: #000000;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--white);
            color: var(--text-color);
            line-height: 1.6;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        /* --- HEADER --- */
        .main-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px; background-color: var(--white);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: sticky; top: 0; z-index: 1000;
        }
        .logo-container img { height: 40px; }
        .header-right { display: flex; align-items: center; gap: 20px; }
        .cart-icon { position: relative; font-size: 1.8rem; color: var(--primary-color); cursor: pointer; }
        #cart-count {
            position: absolute; top: -5px; right: -10px; background-color: var(--accent-color);
            color: var(--white); border-radius: 50%; padding: 2px 6px;
            font-size: 0.7rem; font-weight: bold; display: none;
        }
        .hamburger-menu { cursor: pointer; font-size: 1.8rem; color: var(--primary-color); }

        /* --- Navigasi Samping --- */
        .sidenav {
            height: 100%; width: 0; position: fixed; z-index: 1001; top: 0; left: 0;
            background-color: var(--primary-color); overflow-x: hidden;
            transition: 0.5s ease-in-out; padding-top: 60px;
        }
        .sidenav a, .sidenav .nav-link, .dropdown-btn {
            padding: 10px 15px 10px 32px; text-decoration: none; font-size: 1.2rem;
            color: var(--gray); display: block; transition: 0.3s; cursor: pointer;
            border: none; background: none; width: 100%; text-align: left;
        }
        .sidenav a:hover, .sidenav .nav-link:hover, .dropdown-btn:hover { color: var(--secondary-color); }
        .sidenav .close-btn { position: absolute; top: 15px; right: 25px; font-size: 36px; color: var(--white); }
        .dropdown-content { display: none; background-color: #2c3e50; padding-left: 20px; }
        .dropdown-content a { font-size: 1rem; padding-top: 8px; padding-bottom: 8px; }

        /* --- Styling Umum & Halaman --- */
        .view { display: none; }
        .view.active { display: block; }
        .welcome-section h1 { font-size: 2.5rem; font-weight: 700; }
        .promo-banner-container { margin: 25px 0; border-radius: 15px; overflow: hidden; }
        .promo-banner-container img { width: 100%; display: block; }
        .section-header { margin-top: 40px; margin-bottom: 20px; }
        .section-header h2 { font-size: 1.5rem; font-weight: 600; }
        
        .category-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); 
            gap: 20px; 
            padding: 20px;
            border-radius: 15px;
            background-color: var(--white);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .category-card { text-align: center; cursor: pointer; }
        .category-card .icon-container {
            width: 80px; height: 80px; margin: 0 auto 10px; background-color: #f0f0f0;
            border-radius: 12px; overflow: hidden; transition: transform 0.3s, box-shadow 0.3s;
        }
        .category-card:hover .icon-container { transform: scale(1.05); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .category-card img { width: 100%; height: 100%; object-fit: cover; }
        .category-card p { font-weight: 500; font-size: 0.9rem; }
        .btn { padding: 12px 25px; border: none; border-radius: 5px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: background-color 0.3s; text-decoration: none; display: inline-block;}
        .btn-primary { background-color: var(--secondary-color); color: var(--white); }
        .btn-primary:hover { background-color: #055a96; }

        /* Halaman Produk */
        #page-produk .product-page-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); 
            gap: 20px; 
        }
        .product-item-card { background: var(--white); border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08); display: flex; flex-direction: column; }
        .product-item-card.out-of-stock { opacity: 0.6; }
        .product-item-card .product-image { width: 100%; cursor: pointer; aspect-ratio: 1/1; object-fit: cover; }
        .product-info { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; }
        .product-name { font-size: 1rem; font-weight: bold; color: var(--primary-color); margin-bottom: 15px; flex-grow: 1; }
        .add-to-cart-controls { margin-top: auto; }
        .add-to-cart-btn { 
            width: 100%; background-color: var(--secondary-color); color: var(--white); 
            border: none; border-radius: 5px; padding: 10px; cursor: pointer; 
            font-weight: bold; transition: background-color 0.3s;
        }
        .add-to-cart-btn:hover { background-color: #055a96; }
        .add-to-cart-btn:disabled { background-color: #aaa; }
        
        .quantity-selector { display: flex; justify-content: center; align-items: center; margin-bottom: 15px; }
        .quantity-btn {
            width: 30px; height: 30px; border: 1px solid #ccc; background-color: #f5f5f5;
            cursor: pointer; font-size: 1.2rem; font-weight: bold; line-height: 1;
        }
        .quantity-btn.minus { border-radius: 5px 0 0 5px; }
        .quantity-btn.plus { border-radius: 0 5px 5px 0; }
        .quantity-input {
            width: 50px; height: 30px; text-align: center; border: 1px solid #ccc;
            border-left: none; border-right: none; font-size: 1rem;
            -moz-appearance: textfield;
        }
        .quantity-input::-webkit-outer-spin-button, .quantity-input::-webkit-inner-spin-button {
            -webkit-appearance: none; margin: 0;
        }
        
        .cart-container { padding: 25px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .cart-item { display: flex; align-items: center; border-bottom: 1px solid var(--gray); padding: 15px 0; gap: 15px; }
        .cart-item-img { width: 80px; height: 80px; object-fit: cover; border-radius: 5px; flex-shrink: 0; }
        .cart-item-details { flex-grow: 1; }
        .cart-item-name { font-weight: bold; }
        .cart-item-quantity { display: flex; align-items: center; gap: 10px; }
        .quantity-btn.cart { border-radius: 50%; }
        .checkout-form, .cart-actions { margin-top: 30px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); justify-content: center; align-items: center; padding: 20px; }
        .popup-content { background-color: var(--white); padding: 20px 30px; border-radius: 8px; width: 90%; max-width: 320px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        #toast-notification { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 5px; padding: 16px; position: fixed; z-index: 5000; left: 50%; transform: translateX(-50%); bottom: 30px; opacity: 0; transition: opacity 0.5s, visibility 0.5s; }
        #toast-notification.show { visibility: visible; opacity: 1; }

        .main-header, .welcome-section h1, .promo-banner-container, .section-header, .category-card {
            opacity: 0; visibility: hidden;
        }

        /* Tampilan Mobile */
        @media (max-width: 600px) {
            #page-produk .product-page-grid { grid-template-columns: repeat(3, 1fr); gap: 10px; }
            .product-info { padding: 10px; }
            .product-name { font-size: 0.8rem; margin-bottom: 8px; }
            .quantity-selector { margin-bottom: 8px; }
            .add-to-cart-btn { padding: 8px; font-size: 0.8rem; }
            .quantity-input { width: 35px; }
        }

        /* =========================================
         * === 2. CSS UNTUK ANIMASI LOADING      ===
         * ========================================= */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.7);
            display: none; /* Defaultnya tersembunyi */
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .loader {
            border: 8px solid #f3f3f3; /* Light grey */
            border-top: 8px solid var(--primary-color); /* Blue */
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <header class="main-header">
        <div class="logo-container"> <img src="https://yanoshijapan.github.io/jastip/jastip%202.png" alt="Logo Jastip" style="cursor: pointer;" id="logo-home-btn"> </div>
        <div class="header-right"> <a class="cart-icon">🛒<span id="cart-count">0</span></a> <div class="hamburger-menu">☰</div> </div>
    </header>
    <nav id="mySidenav" class="sidenav">
        <a href="javascript:void(0)" class="close-btn">&times;</a>
        <a class="nav-link" data-page="home">Halaman Utama</a>
        <button class="dropdown-btn">Kategori Produk ▾</button>
        <div class="dropdown-content">
            <a class="nav-link" data-category="Mie">Aneka Mie</a> <a class="nav-link" data-category="Bumbu">Aneka Bumbu</a> <a class="nav-link" data-category="Sambal">Aneka Sambal</a> <a class="nav-link" data-category="Kopi">Kopi, Teh & Minuman</a> <a class="nav-link" data-category="Snack">Snack & Cemilan</a> <a class="nav-link" data-category="Skincare">Skincare</a> <a class="nav-link" data-category="Sabun">Sabun & Shampo</a> <a class="nav-link" data-category="Rokok">Rokok & Perlengkapan</a> <a class="nav-link" data-category="Request">Request Khusus</a>
        </div>
        <a class="nav-link" data-page="keranjang">Lihat Daftar Pesanan</a>
        <a href="https://wa.me/6281315431551?text=Halo%20Admin%20Jastip" target="_blank">Kontak Admin</a>
    </nav>
    <main class="container">
        <div id="page-utama" class="view active">
            <section class="promo-banner-container"> <img src="https://yanoshijapan.github.io/gambarbelanja/gambars2.png" alt="Promo Banner"> </section>
            <section class="category-section">
                <div class="section-header"><h2>Pilih Kategori</h2></div>
                <div class="category-grid">
                    <div class="category-card" data-category="Mie"><div class="icon-container"><img src="https://yanoshijapan.github.io/gambarbelanja/anekamie.png"></div><p>Aneka Mie</p></div>
                    <div class="category-card" data-category="Bumbu"><div class="icon-container"><img src="https://yanoshijapan.github.io/gambarbelanja/anekabumbu.png"></div><p>Aneka Bumbu</p></div>
                    <div class="category-card" data-category="Sambal"><div class="icon-container"><img src="https://yanoshijapan.github.io/gambarbelanja/anekasambal.png"></div><p>Aneka Sambal</p></div>
                    <div class="category-card" data-category="Kopi"><div class="icon-container"><img src="https://yanoshijapan.github.io/gambarbelanja/kopi.png"></div><p>Kopi, Teh dan Minuman Sachet</p></div>
                    <div class="category-card" data-category="Snack"><div class="icon-container"><img src="https://yanoshijapan.github.io/gambarbelanja/snack.png"></div><p>Snack dan Cemilan</p></div>
                    <div class="category-card" data-category="Skincare"><div class="icon-container"><img src="https://yanoshijapan.github.io/gambarbelanja/skincare.png"></div><p>Skincare</p></div>
                    <div class="category-card" data-category="Sabun"><div class="icon-container"><img src="https://yanoshijapan.github.io/gambarbelanja/sabun.png"></div><p>Sabun & Shampo</p></div>
                    <div class="category-card" data-category="Rokok"><div class="icon-container"><img src="https://yanoshijapan.github.io/gambarbelanja/rokok.png"></div><p>Rokok dan Perlengkapan Pribadi</p></div>
                    <div class="category-card" data-category="Request"><div class="icon-container"><img src="https://yanoshijapan.github.io/gambarbelanja/req.png"></div><p>Request Khusus</p></div>
                </div>
            </section>
        </div>
        <div id="page-produk" class="view">
            <h1 id="product-page-title" style="margin-bottom: 20px;"></h1>
            <div id="product-container" class="product-page-grid"></div>
            <br><a href="#" class="btn back-to-home" style="background-color: #bdc3c7;">Kembali ke Halaman Utama</a>
        </div>
        <div id="page-keranjang" class="view">
            <div class="cart-container">
                <h1>Daftar Pesanan Kamu</h1>
                <div id="cart-items-container"><p>Daftar pesanan masih kosong.</p></div>
                <div class="checkout-form">
                    <div class="form-group"><label for="customer-name">Nama Lengkap</label><input type="text" id="customer-name" placeholder="Masukkan nama lengkap"></div>
                    <div class="form-group"><label for="customer-whatsapp">Nomor WhatsApp Aktif</label><input type="tel" id="customer-whatsapp" placeholder="Contoh: 081234567890"></div>
                </div>
                <div class="cart-actions">
                    <button class="btn back-to-home" style="background-color: #bdc3c7;">Tambah Item Lain</button>
                    <br></br>
                    <button id="checkout-btn" class="btn btn-primary">Kirim Daftar Pesanan</button>
                </div>
            </div>
        </div>
    </main>
    <div id="checkout-popup" class="modal">
        <div class="popup-content">
            <h2>Terima Kasih!</h2>
            <p>Daftar pesananmu kita proses ya...</p><br>
            <a href="#" id="konfirmasi-wa-btn" class="btn" target="_blank" style="background-color: #25D366; color: white;">Konfirmasi via WhatsApp</a>
            <a href="LINK_FORMULIR_UTAMA_ANDA" id="back-to-form-btn" class="btn" target="_blank" style="background-color: #8e44ad; color: white; margin-top: 10px; width: 100%; box-sizing: border-box;">Kembali ke Form</a>
            
            <br><br>
            <button class="btn btn-primary back-to-home">Tutup</button>
        </div>
    </div>
    <div id="notification-popup" class="modal"><div class="popup-content"><p id="notification-message" style="margin-bottom: 20px;"></p><button id="close-notification-btn" class="btn btn-primary">OK</button></div></div>
    <div id="toast-notification"></div>

    <div id="loading-overlay">
        <div class="loader"></div>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxfft49o6Y0SDZx-OwAbDgddJksOL63LSFHiq8rInRI3lsEQvCEI-7ypz1K_ePWMSwm/exec';
    const ADMIN_WHATSAPP_NUMBER = '6281315431551';
    
    // ==================================================
    // === 2. Fungsi untuk menampilkan/menyembunyikan loading ===
    // ==================================================
    const loadingOverlay = document.getElementById('loading-overlay');
    const showLoader = () => loadingOverlay.style.display = 'flex';
    const hideLoader = () => loadingOverlay.style.display = 'none';

    const CATEGORY_DETAILS = { /* ... isinya sama, tidak perlu diubah ... */ };
    
    const views = document.querySelectorAll('.view');
    const showView = (viewId) => { views.forEach(v => v.classList.remove('active')); document.getElementById(viewId)?.classList.add('active'); window.scrollTo(0, 0); };
    const showProductPage = (cat) => { /* ... isinya sama, tidak perlu diubah ... */ };

    const fetchAndRenderProducts = (cat) => { 
        const pc = document.getElementById('product-container'); 
        pc.innerHTML = ''; // Kosongkan dulu
        showLoader(); // Tampilkan loading
        
        fetch(`${WEB_APP_URL}?action=getProducts&category=${cat}`)
            .then(res => res.json())
            .then(res => { 
                if (res.status === 'success') renderProducts(res.data); 
                else pc.innerHTML = `<p>Gagal: ${res.message}</p>`; 
            })
            .catch(err => pc.innerHTML = `<p>Error: ${err.message}</p>`)
            .finally(() => hideLoader()); // Sembunyikan loading (baik sukses maupun gagal)
    };

    const renderProducts = (products) => { /* ... isinya sama, tidak perlu diubah ... */ };
    window.changeProductQuantity = (button, change) => { /* ... isinya sama, tidak perlu diubah ... */ };
    window.addToCart = (button, productId) => { /* ... isinya sama, tidak perlu diubah ... */ };
    const getCart = () => JSON.parse(localStorage.getItem('jastipCartSimple')) || [];
    const saveCart = (cart) => { localStorage.setItem('jastipCartSimple', JSON.stringify(cart)); updateCartIcon(); };
    const updateCartIcon = () => { /* ... isinya sama, tidak perlu diubah ... */ };
    const renderCartPage = () => { /* ... isinya sama, tidak perlu diubah ... */ };
    window.updateQuantity = (id, chg) => { /* ... isinya sama, tidak perlu diubah ... */ };

    document.getElementById('checkout-btn').addEventListener('click', () => { 
        const name = document.getElementById('customer-name').value.trim(); 
        const whatsapp = document.getElementById('customer-whatsapp').value.trim(); 
        if (!name || !whatsapp) { 
            showNotificationPopup('Lengkapi Nama & WhatsApp.'); 
            return; 
        } 
        
        const cart = getCart(); 
        if (cart.length === 0) return; 

        showLoader(); // Tampilkan loading saat tombol checkout di klik
        
        let details = `*Pesanan dari ${name}*\n\n`; 
        cart.forEach(item => { details += `- ${item.name} (Qty: ${item.quantity})\n`; }); 
        details += `\nMohon diproses.`; 
        document.getElementById('konfirmasi-wa-btn').href = `https://wa.me/${ADMIN_WHATSAPP_NUMBER}?text=${encodeURIComponent(details)}`; 
        
        const data = { action: 'newOrder', name, whatsapp, items: cart }; 
        
        fetch(WEB_APP_URL, { 
            method: 'POST', 
            headers: { 'Content-Type': 'text/plain;charset=utf-8' }, 
            body: JSON.stringify(data) 
        })
        .then(res => res.json())
        .then(result => { 
            if (result.status === 'success') { 
                saveCart([]); 
                document.getElementById('checkout-popup').style.display = 'flex'; 
            } else { 
                showNotificationPopup('Gagal: ' + result.message); 
            } 
        })
        .catch(err => showNotificationPopup('Error: ' + err.message))
        .finally(() => hideLoader()); // Sembunyikan loading (baik sukses maupun gagal)
    });

    const initializeNav = () => { /* ... isinya sama, tidak perlu diubah ... */ };
    let toastTimeout;
    const showToast = (msg) => { /* ... isinya sama, tidak perlu diubah ... */ };
    const showNotificationPopup = (msg) => { /* ... isinya sama, tidak perlu diubah ... */ };
    document.getElementById('close-notification-btn').onclick = () => { document.getElementById('notification-popup').style.display = "none"; }
    
    initializeNav();
    updateCartIcon();
    showView('page-utama');

    const tl = gsap.timeline({ defaults: { ease: "power2.out" } });
    tl.fromTo(".main-header", { y: -50 }, { y: 0, opacity: 1, visibility: "visible", duration: 0.8 }, "+=0.2")
      .fromTo(".promo-banner-container", { scale: 0.9 }, { scale: 1, opacity: 1, visibility: "visible", duration: 0.7 }, "-=0.3")
      .fromTo(".section-header", { y: 20 }, { y: 0, opacity: 1, visibility: "visible", duration: 0.5 })
      .fromTo(".category-card", { y: 20, opacity: 0 }, { y: 0, opacity: 1, visibility: "visible", duration: 0.5, stagger: 0.1 }, "-=0.3");
});
</script>

</body>
</html>
